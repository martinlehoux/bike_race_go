{{template "layout.html" . }}

{{ define "content" }}
<main class="flex flex-col mx-4 items-center">
  <h1 class="text-xl font-bold text-blue-900 mt-4">{{.Data.Race.Name}}</h1>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 justify-start">
    {{if .Data.Race.Permissions.CanOpenForRegistration}}
    <form action="/races/{{.Data.Race.Id.String}}/open_for_registration" method="post"
      class="flex flex-col max-w-screen-sm w-full gap-2 rounded shadow p-2 mt-4 h-max">
      <div class="flex flex-col lg:flex-row justify-between">
        <label for="start_at">{{ call .T "raceStart" }}</label>
        <input type="datetime-local" id="start_at" name="start_at" class="border px-2 py-1 rounded" {{if not
          .Data.Race.StartAt.IsZero}}value="{{.Data.Race.StartAt.Format `2006-01-02T15:04`}}" {{end}} />
      </div>
      <div class="flex flex-col lg:flex-row justify-between">
        <label for="maximum_participants">{{ call .T "maximumParticipants" }}</label>
        <input type="number" name="maximum_participants" id="maximum_participants" min="1"
          class="border px-2 py-1 rounded" value={{.Data.Race.MaximumParticipants}}>
      </div>

      <input type="submit" value={{ call .T "openForRegistrationButton" }} class="btn-primary">
    </form>
    {{ end }}

    {{if .Data.Race.Permissions.CanUpdateDescription}}
    <form action="/races/{{.Data.Race.Id.String}}/update_description" method="post" enctype="multipart/form-data"
      class="flex flex-col max-w-screen-sm w-full gap-2 rounded shadow p-2 mt-4">
      <div class="w-full flex justify-center">
        {{if .Data.Race.CoverImage}}
        <img src="/media/images/{{.Data.Race.CoverImage}}" alt={{ call .T "raceCoverImage" }} class="object-contain">
        {{else}}
        <div class="bg-gray-300 w-full"></div>
        {{end}}
      </div>
      <div class="flex flex-col lg:flex-row justify-between">
        <label for="cover_image">{{ call .T "raceCoverImage" }}</label>
        <input type="file" name="cover_image" id="cover_image" />
        <div>
          <label for="clear_cover_image">{{ call .T "clearLabel" }}</label>
          <input type="checkbox" name="clear_cover_image" id="clear_cover_image">
        </div>
      </div>
      <input type="submit" value={{ call .T "updateDescriptionButton" }} class="btn-primary">
    </form>
    {{end}}
  </div>

  <table class="mt-6 max-w-screen-xl w-full table-auto">
    <thead>
      <tr>
        <th>{{ call .T "user" }}</th>
        <th>{{ call .T "registrationDate"}}</th>
        <th>{{ call .T "documents" }}</th>
        <th>{{ call .T "status" }}</th>
        <th>{{ call .T "actions" }}</th>
      </tr>
    </thead>
    <tbody>
      {{range .Data.RaceRegistrations}}
      <tr>
        <td>{{.User.Username}}</td>
        <td>{{.RegisteredAt.Format "Monday, January 2, 2006 at 15:04"}}</td>
        <td>
          {{if .MedicalCertificate}}
          <a href="/media/files/{{.MedicalCertificate}}" class="btn-secondary"
            download="{{.User.Username}}_medical_certificate.xlsx">{{ call $.T
            "medicalCertificate_download"
            }}</a>
          {{end}}
        </td>
        <td><span class="chip bg-green-700">{{.Status}}</span></td>
        <td>
          {{if .Permissions.CanApprove}}
          <form action="/races/{{$.Data.Race.Id.String}}/registrations/{{.User.Id.String}}/approve" method="post">
            <input type="submit" value={{ call $.T "approveButton" }} class="btn-primary">
          </form>
          {{end}}
          {{if .Permissions.CanApproveMedicalCertificate}}
          <form action="/races/{{$.Data.Race.Id.String}}/registrations/{{.User.Id.String}}/approve_medical_certificate"
            method="post">
            <input type="submit" value={{ call $.T "approveMedicalCertificate_button" }} class="btn-primary">
          </form>
          {{end}}
        </td>
      </tr>
      {{end}}
    </tbody>
  </table>
</main>



{{ end }}